# 排序与聚合算法(Sorting & Aggregations Algorithms)

---

## 排序(Sorting)

### 外部归并排序算法(External Sort-Merge Algorithm)

约定M为内存缓冲池可容纳的块数，N为关系对应的磁盘上需要排序的块数。首先，一直从磁盘中每次读取`min(M,磁盘上剩余未排序块数)`个块入内存中排序并将结果输出到磁盘。然后，将产生的`runs`一直做刚才的步骤直到需要排序的`runs`小于等于M-1。最后，M-1个块用于读每个`run`的第一个元组并用一个块作为输出缓冲区，一直排序到所有`run`没有元素。

整体有两个阶段，一个是生成`runs`的阶段，一个是`Merge`阶段，将每个`runs`文件排序生成一个结果文件。

### 外部归并排序的开销分析(Cost Analysis of External Sort-Merge)

见教材。

---

## 连接操作(Join Operations)

**嵌套循环连接(Nested-Loop Join)**

**块嵌套循环连接(Block Nested-Loop Join)：** 基于嵌套循环连接，充分利用局部性优化，减少块交换的次数。

**索引嵌套循环连接(Index Nested-Loop Join)：** 遍历一个关系，在另一个关系的索引中查找匹配项。

**归并连接(Merge Join)：** 先找出一个关系中的待连接属性相同的所有元素，然后在另一个关系中找匹配项，如此循环。每个关系的每一项只会被访问一次，因而每个块也只会被访问一次。开销包括可能的排序开销和两个关系的所有块的IO带来的数据传输和磁道定位开销。为两个关系分配更多的内存缓冲区可以减少磁道定位开销。

**哈希连接(Hash Join)：** 把每个关系分成元素具有相同哈希值的若干个组。
